# 5.2.2-代码逻辑

1）自动抓取.vbs脚本部分，设置一个无限循环，每隔特定时间运行一次监控系统.xlsm

2）监控系统.xlsm，为了实现自动运行的效果，需要增加一个工作簿打开事件，vbs脚本打开文件时，自动运行程序，实现以下功能。

- 2.1）（前提）所有测量文件放入【1】输入文件夹下
- 2.2）对【1】输入文件夹下的所有文件进行遍历
- 2.3）依次解析测量文件，将信息存入数据库.xlsx，根据文件类型的不同使用不同的解析方式
- 2.4）备份已解析文件，删除原文件
- 2.5）对数据库文件的各零件测量数值单元格区域进行排序，按正序时间排序，即时间对应数字越大，对应的列号越大，如图5-7所示
- 2.6）获取最后5个读入的零件测量数据
- 2.6.1）分别计算其合格率
- 2.6.2）超出公差测点识别，按最新一次测量值进行排序，识别Top3问题
- 2.7）复制预警模板.xlsx模板到【2】输出文件夹下，重新命名文件名为最后一次测量对应的唯一ID号
- 2.8）更新预警Excel文件对应信息
- 2.9）对【2】输出文件夹下所有文件进行遍历，依次发送邮件到指定人员

---
```{figure} image/5-7.png
---
width: 100%
align: center
---
```
<br />
<center>图5-7 排序后的数据</center>

---
<br />